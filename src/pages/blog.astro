---
import MainLayout from '../layouts/MainLayout.astro';
import BlogCard from '../components/BlogCard.astro';
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';

const posts = await getCollection('blog', ({ data }: CollectionEntry<'blog'>) => {
  return !data.draft;
});

// Sort posts by date
const sortedPosts = posts.sort(
  (a: CollectionEntry<'blog'>, b: CollectionEntry<'blog'>) =>
    b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

// Create a typed function to render BlogCard
const renderBlogCard = (post: CollectionEntry<'blog'>) => (
  <BlogCard
    title={post.data.title}
    description={post.data.description}
    pubDate={post.data.pubDate}
    author={post.data.author}
    slug={post.slug}
    image={post.data.image}
  />
);
---

<MainLayout
  title="Blog - Tech AI Blog"
  description="Explore our latest articles on technology and artificial intelligence"
>
  <section class="max-w-6xl mx-auto py-12">
    <h1 class="text-4xl font-bold text-secondary-900 dark:text-white mb-8">Latest Articles</h1>

    <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
      {sortedPosts.map(renderBlogCard)}
    </div>
  </section>
</MainLayout>
