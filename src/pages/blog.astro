---
import MainLayout from '../layouts/MainLayout.astro';
import BlogCard from '../components/BlogCard.astro';
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';

// Search icon
const searchIcon = `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
  <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
</svg>`;

// Get and sort blog posts
const posts = await getCollection('blog', ({ data }) => {
  return !data.draft;
});

const sortedPosts = posts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const renderBlogCard = (post: CollectionEntry<'blog'>) => {
  const { data, slug } = post;
  return (
    <BlogCard
      title={data.title}
      description={data.description}
      pubDate={data.pubDate}
      author={data.author}
      slug={slug}
      image={data.image}
      category={data.category}
      readingTime={data.readingTime || '5 min read'}
    />
  );
};
---

<MainLayout
  title="Blog - Tech AI Blog"
  description="Explore our latest articles on technology and artificial intelligence"
>
  <section class="max-w-6xl mx-auto px-4 py-12">
    <div class="text-center mb-12">
      <h1 class="text-4xl md:text-5xl font-bold text-secondary-900 dark:text-white mb-4">
        Latest Articles
      </h1>
      <p class="text-lg text-secondary-600 dark:text-secondary-400 max-w-2xl mx-auto">
        Discover insights about AI, technology, and software development
      </p>
    </div>

    <div class="mb-12">
      <div class="max-w-xl mx-auto">
        <div class="relative">
          <span
            class="absolute inset-y-0 left-3 flex items-center text-secondary-400"
            set:html={searchIcon}
          />
          <input
            type="search"
            placeholder="Search articles..."
            class="w-full pl-10 pr-4 py-2 border border-secondary-200 dark:border-secondary-700 rounded-xl bg-white dark:bg-secondary-800 text-secondary-900 dark:text-white placeholder-secondary-400 focus:outline-none focus:ring-2 focus:ring-primary-500 dark:focus:ring-primary-400"
          />
        </div>
      </div>
    </div>

    <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
      {sortedPosts.map(renderBlogCard)}
    </div>

    {
      sortedPosts.length === 0 && (
        <div class="text-center py-12">
          <p class="text-secondary-600 dark:text-secondary-400">No articles found.</p>
        </div>
      )
    }
  </section>
</MainLayout>
